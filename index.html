<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TiffyAI AR Shooter</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; background:black; font-family: monospace; }
    #hud {
      position:absolute; top:10px; left:50%; transform:translateX(-50%);
      background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.25);
      border-radius:12px; padding:10px 20px; color:#00f0ff; font-size:18px;
      backdrop-filter: blur(8px); box-shadow:0 0 20px rgba(0,255,255,0.4);
      z-index:9999;
    }
  </style>
</head>
<body>
<div id="hud">ðŸ‘¾ Tap anywhere to shoot magic orbs!</div>

<a-scene background="color: black" vr-mode-ui="enabled: true">

  <!-- Assets -->
  <a-assets>
    <!-- Environment -->
    <video id="frontVideo" autoplay loop muted playsinline src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/front.mp4"></video>
    <video id="backVideo" autoplay loop muted playsinline src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/back.mp4"></video>
    <video id="leftVideo" autoplay loop muted playsinline src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/left.mp4"></video>
    <video id="rightVideo" autoplay loop muted playsinline src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/right.mp4"></video>
    <video id="topVideo" autoplay loop muted playsinline src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/top.mp4"></video>
    <video id="bottomVideo" autoplay loop muted playsinline src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/bottom.mp4"></video>

    <!-- Game -->
    <video id="orbVideo" autoplay loop muted playsinline src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/orb.webm"></video>
    <video id="enemyVideo" autoplay loop muted playsinline src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/enemies.mp4"></video>

    <!-- Sounds -->
    <audio id="shootSound" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/fire.wav"></audio>
    <audio id="explodeSound" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/blocks.wav"></audio>
    <audio id="enemySwooch" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/swooch.wav"></audio>
    <audio id="bgMusic" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/playing.wav" autoplay loop></audio>
  </a-assets>

  <!-- Environment planes -->
  <a-plane src="#frontVideo" position="0 1.6 -50" rotation="0 0 0" width="100" height="100"></a-plane>
  <a-plane src="#backVideo" position="0 1.6 50" rotation="0 180 0" width="100" height="100"></a-plane>
  <a-plane src="#leftVideo" position="-50 1.6 0" rotation="0 90 0" width="100" height="100"></a-plane>
  <a-plane src="#rightVideo" position="50 1.6 0" rotation="0 -90 0" width="100" height="100"></a-plane>
  <a-plane src="#topVideo" position="0 101.6 0" rotation="90 0 0" width="150" height="150"></a-plane>
  <a-plane src="#bottomVideo" position="0 -48.4 0" rotation="-90 0 0" width="100" height="100"></a-plane>

  <!-- Player camera -->
  <a-entity id="player" camera look-controls wasd-controls position="0 1.6 0"></a-entity>

</a-scene>

<script>
  // Play all videos
  window.addEventListener('load',()=>{
    ['frontVideo','backVideo','leftVideo','rightVideo','topVideo','bottomVideo','orbVideo','enemyVideo'].forEach(id=>{
      const vid=document.getElementById(id);
      vid.muted=true;
      vid.play().catch(()=>{});
    });
    // Play music
    const bg = document.getElementById('bgMusic');
    bg.volume = 0.3;
    bg.play().catch(()=>{});
  });

  const scene = document.querySelector('a-scene');
  const camera = document.getElementById('player');
  const enemies = [];
  const orbs = [];

  // Shoot orb
  function shootOrb(){
    const orb = document.createElement('a-video');
    orb.setAttribute('src','#orbVideo');
    orb.setAttribute('width','3');
    orb.setAttribute('height','3');
    orb.setAttribute('transparent','true');

    // Position slightly in front of camera
    const pos = camera.object3D.position.clone();
    const dir = new THREE.Vector3();
    camera.object3D.getWorldDirection(dir);
    orb.object3D.position.copy(pos).add(dir.clone().multiplyScalar(1.5));
    scene.appendChild(orb);

    // Trail
    const trail = document.createElement('a-entity');
    trail.setAttribute('particle-system',{
      preset:'dust',
      particleCount:50,
      color:'#00ffff,#ffffff',
      size:0.2,
      velocityValue:'0 0 0',
      duration:0.3
    });
    orb.appendChild(trail);

    orbs.push({el:orb,dir:dir});

    // Sound
    const fire = document.getElementById('shootSound').cloneNode();
    fire.play();
  }

  // Spawn enemy
  function spawnEnemy(){
    const enemy = document.createElement('a-video');
    enemy.setAttribute('src','#enemyVideo');
    enemy.setAttribute('width','2');
    enemy.setAttribute('height','2');
    enemy.setAttribute('transparent','true');

    const side = Math.floor(Math.random()*3); // 0=back,1=left,2=right
    let pos = new THREE.Vector3();
    if(side===0){ pos.set(Math.random()*20-10,1.6,30); }       // back
    else if(side===1){ pos.set(-25,1.6,Math.random()*20-10); } // left
    else { pos.set(25,1.6,Math.random()*20-10); }              // right

    enemy.object3D.position.copy(pos);
    scene.appendChild(enemy);
    enemies.push({el:enemy,side,speed:0.2+Math.random()*0.2});

    // swooch sound
    const swooch = document.getElementById('enemySwooch').cloneNode();
    swooch.play();
  }

  // Collision detection
  function isColliding(a,b){
    return a.object3D.position.distanceTo(b.object3D.position)<1;
  }

  // Game loop
  function gameLoop(){
    // Move enemies
    enemies.forEach((e,i)=>{
      const dir = new THREE.Vector3();
      dir.subVectors(camera.object3D.position,e.el.object3D.position).normalize();
      e.el.object3D.position.add(dir.multiplyScalar(e.speed));

      if(e.el.object3D.position.distanceTo(camera.object3D.position)<0.5){
        e.el.remove();
        enemies.splice(i,1);
      }
    });

    // Move orbs
    orbs.forEach((o,i)=>{
      o.el.object3D.position.add(o.dir.clone().multiplyScalar(0.5));

      enemies.forEach((e,j)=>{
        if(isColliding(o.el,e.el)){
          // Explosion
          const explosion = document.createElement('a-box');
          explosion.setAttribute('position',e.el.getAttribute('position'));
          explosion.setAttribute('depth','2');
          explosion.setAttribute('height','2');
          explosion.setAttribute('width','2');
          explosion.setAttribute('color','#00ffff');
          scene.appendChild(explosion);
          setTimeout(()=>explosion.remove(),300);

          // Block sound
          const blockS = document.getElementById('explodeSound').cloneNode();
          blockS.play();

          e.el.remove();
          enemies.splice(j,1);
          o.el.remove();
          orbs.splice(i,1);
        }
      });

      if(o.el.object3D.position.distanceTo(camera.object3D.position)>50){
        o.el.remove();
        orbs.splice(i,1);
      }
    });

    requestAnimationFrame(gameLoop);
  }

  window.addEventListener('click',shootOrb);
  setInterval(spawnEnemy,2000);
  gameLoop();
</script>

</body>
</html>
