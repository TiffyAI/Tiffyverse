<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TiffyAI AR Shooter</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-particle-system-component@1.0.0/dist/aframe-particle-system-component.min.js"></script>
  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; background:black; }
    #hud {
      position:absolute; top:10px; left:50%; transform:translateX(-50%);
      background: rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.25);
      border-radius:12px; padding:10px 20px;
      color:#00f0ff; font-size:18px; font-family: monospace;
      backdrop-filter: blur(8px); box-shadow:0 0 20px rgba(0,255,255,0.4); z-index:9999;
    }
  </style>
</head>
<body>
<div id="hud">ðŸ‘¾ Tap/click to shoot magic orbs!</div>

<a-scene>
  <!-- Assets -->
  <a-assets>
    <!-- Environment -->
    <video id="frontVideo" autoplay loop muted playsinline crossorigin="anonymous" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/front.mp4"></video>
    <video id="backVideo" autoplay loop muted playsinline crossorigin="anonymous" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/back.mp4"></video>
    <video id="leftVideo" autoplay loop muted playsinline crossorigin="anonymous" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/left.mp4"></video>
    <video id="rightVideo" autoplay loop muted playsinline crossorigin="anonymous" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/right.mp4"></video>
    <video id="topVideo" autoplay loop muted playsinline crossorigin="anonymous" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/top.mp4"></video>
    <video id="bottomVideo" autoplay loop muted playsinline crossorigin="anonymous" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/bottom.mp4"></video>

    <!-- Game objects -->
    <video id="orbVideo" autoplay loop muted playsinline crossorigin="anonymous" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/orb.mp4"></video>
    <video id="enemyVideo" autoplay loop muted playsinline crossorigin="anonymous" src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/enemies.mp4"></video>
  </a-assets>

  <!-- Environment planes -->
  <a-plane src="#frontVideo" position="0 1.6 -50" rotation="0 0 0" width="100" height="100"></a-plane>
  <a-plane src="#backVideo" position="0 1.6 50" rotation="0 180 0" width="100" height="100"></a-plane>
  <a-plane src="#leftVideo" position="-50 1.6 0" rotation="0 90 0" width="100" height="100"></a-plane>
  <a-plane src="#rightVideo" position="50 1.6 0" rotation="0 -90 0" width="100" height="100"></a-plane>
  <a-plane src="#topVideo" position="0 101.6 0" rotation="90 0 0" width="150" height="150"></a-plane>
  <a-plane src="#bottomVideo" position="0 -48.4 0" rotation="-90 0 0" width="100" height="100"></a-plane>

  <!-- Player camera -->
  <a-entity id="player" camera look-controls position="0 1.6 0"></a-entity>
</a-scene>

<script>
  const scene = document.querySelector('a-scene');
  const orbVideo = document.querySelector('#orbVideo');
  const enemyVideo = document.querySelector('#enemyVideo');
  const orbs = [];
  const enemies = [];

  // Play all videos
  window.addEventListener('load', () => {
    ['frontVideo','backVideo','leftVideo','rightVideo','topVideo','bottomVideo','orbVideo','enemyVideo'].forEach(id => {
      const vid = document.querySelector('#'+id);
      vid.muted = true;
      vid.play().catch(err => console.warn(`Autoplay blocked for ${id}:`, err));
    });
  });

  // Spawn enemy
  function spawnEnemy(){
    const x = Math.random()*40-20;
    const z = Math.random()*40-20;
    const y = 1.6 + Math.random()*2;
    const enemy = document.createElement('a-video');
    enemy.setAttribute('src','#enemyVideo');
    enemy.setAttribute('width','4');
    enemy.setAttribute('height','4');
    enemy.setAttribute('position',`${x} ${y} ${-50}`);
    enemy.setAttribute('transparent','true');
    scene.appendChild(enemy);
    enemies.push({el:enemy, speed:0.2 + Math.random()*0.3});
  }

  // Shoot orb
  function shootOrb(){
    const orb = document.createElement('a-video');
    orb.setAttribute('src','#orbVideo');
    orb.setAttribute('width','1.2');
    orb.setAttribute('height','1.2');
    orb.setAttribute('position','0 1.6 -1.5');
    orb.setAttribute('transparent','true');

    // Particle trail
    orb.setAttribute('particle-system',{
      preset:'dust',
      color:'#00ffff, #00ff88',
      particleCount:50,
      size:0.1,
      velocityValue:{x:0,y:0,z:0.1},
      spread:{x:0.2,y:0.2,z:0.2}
    });

    scene.appendChild(orb);
    orbs.push({el:orb, speed:0.5});
  }

  // Collision detection
  function checkCollision(a,b){
    const apos = a.getAttribute('position');
    const bpos = b.getAttribute('position');
    const dx = apos.x - bpos.x;
    const dy = apos.y - bpos.y;
    const dz = apos.z - bpos.z;
    const distance = Math.sqrt(dx*dx + dy*dy + dz*dz);
    return distance < 2;
  }

  // Game loop
  function gameLoop(){
    // Move enemies
    for(let i=enemies.length-1;i>=0;i--){
      const e=enemies[i];
      const pos = e.el.getAttribute('position');
      pos.z += e.speed;
      e.el.setAttribute('position', pos);
      if(pos.z>5){ scene.removeChild(e.el); enemies.splice(i,1); }
    }

    // Move orbs
    for(let j=orbs.length-1;j>=0;j--){
      const o=orbs[j];
      const pos=o.el.getAttribute('position');
      pos.z -= o.speed;
      o.el.setAttribute('position', pos);
      // Remove if too far
      if(pos.z<-60){ scene.removeChild(o.el); orbs.splice(j,1); }
    }

    // Check collisions
    for(let i=enemies.length-1;i>=0;i--){
      for(let j=orbs.length-1;j>=0;j--){
        if(checkCollision(enemies[i].el, orbs[j].el)){
          const explosion = document.createElement('a-sphere');
          const pos = enemies[i].el.getAttribute('position');
          explosion.setAttribute('position', pos);
          explosion.setAttribute('radius',1.5);
          explosion.setAttribute('color','#00ffff');
          explosion.setAttribute('opacity',0.8);
          explosion.setAttribute('animation',{
            property:'scale', to:'0 0 0', dur:600, easing:'easeOutQuad'
          });
          scene.appendChild(explosion);

          setTimeout(()=>{ scene.removeChild(explosion); },600);
          scene.removeChild(enemies[i].el);
          scene.removeChild(orbs[j].el);
          enemies.splice(i,1);
          orbs.splice(j,1);
          break;
        }
      }
    }

    requestAnimationFrame(gameLoop);
  }

  // Spawn enemies every 2s
  setInterval(spawnEnemy,2000);

  // Shoot on tap
  window.addEventListener('click', shootOrb);

  // Start loop
  gameLoop();
</script>
</body>
</html>
