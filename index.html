<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TiffyAI AR Shooter</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#000; }

    /* Glass HUD */
    #hud {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 12px;
      padding: 10px 20px;
      color: #00f0ff;
      font-family: monospace;
      font-size: 18px;
      backdrop-filter: blur(8px);
      box-shadow: 0 0 20px rgba(0,255,255,0.4);
      z-index: 9999;
    }

    /* Explosion animation */
    .explosion {
      animation: explode 0.6s ease-out forwards;
    }

    @keyframes explode {
      0%   { scale:1; opacity:1; }
      50%  { scale:1.6; opacity:0.8; }
      100% { scale:0; opacity:0; }
    }
  </style>
</head>
<body>
<div id="hud">ðŸ‘¾ Tap anywhere to shoot magic orbs!</div>

<a-scene>
  <a-assets>
    <!-- Background MP4s -->
    <video id="frontVideo" autoplay loop muted playsinline src="front.mp4"></video>
    <video id="backVideo" autoplay loop muted playsinline src="back.mp4"></video>
    <video id="leftVideo" autoplay loop muted playsinline src="left.mp4"></video>
    <video id="rightVideo" autoplay loop muted playsinline src="right.mp4"></video>
    <video id="topVideo" autoplay loop muted playsinline src="top.mp4"></video>
    <video id="bottomVideo" autoplay loop muted playsinline src="bottom.mp4"></video>

    <!-- Orb and enemy videos -->
    <video id="orbVideo" autoplay loop muted playsinline src="orb.mp4"></video>
    <video id="enemyVideo" autoplay loop muted playsinline src="enemies.mp4"></video>
  </a-assets>

  <!-- Cube environment -->
  <a-plane src="#frontVideo" position="0 1.6 -50" rotation="0 0 0" width="100" height="100"></a-plane>
  <a-plane src="#backVideo" position="0 1.6 50" rotation="0 180 0" width="100" height="100"></a-plane>
  <a-plane src="#leftVideo" position="-50 1.6 0" rotation="0 90 0" width="100" height="100"></a-plane>
  <a-plane src="#rightVideo" position="50 1.6 0" rotation="0 -90 0" width="100" height="100"></a-plane>
  <a-plane src="#topVideo" position="0 101.6 0" rotation="-90 0 0" width="150" height="150"></a-plane>
  <a-plane src="#bottomVideo" position="0 -48.4 0" rotation="90 0 0" width="100" height="100"></a-plane>

  <!-- Player -->
  <a-entity id="player" camera position="0 1.6 0" look-controls wasd-controls></a-entity>
</a-scene>

<script>
  const scene = document.querySelector('a-scene');
  const player = document.getElementById('player');

  const orbs = [];
  const enemies = [];

  // Spawn enemy from back/left/right
  function spawnEnemy() {
    const side = Math.floor(Math.random()*3);
    let x=0, z=0;
    if(side===0){ x=-45; z=0; }       // left
    if(side===1){ x=45; z=0; }        // right
    if(side===2){ x=0; z=45; }        // back

    const enemy = document.createElement('a-video');
    enemy.setAttribute('src','#enemyVideo');
    enemy.setAttribute('position',`${x} 1.6 ${z}`);
    enemy.setAttribute('width',2);
    enemy.setAttribute('height',2);
    scene.appendChild(enemy);
    enemies.push({el:enemy, x:x, y:1.6, z:z, speed:0.3 + Math.random()*0.3});
  }

  // Shoot orb from front
  function shootOrb() {
    const orb = document.createElement('a-video');
    orb.setAttribute('src','#orbVideo');
    const pos = player.getAttribute('position');
    orb.setAttribute('position', `${pos.x} ${pos.y} ${pos.z-1}`); // front direction
    orb.setAttribute('width',1);
    orb.setAttribute('height',1);
    scene.appendChild(orb);
    orbs.push({el:orb, x:pos.x, y:pos.y, z:pos.z-1, speed:0.8});
  }

  // Check collision
  function checkCollision(orbObj, enemyObj){
    const dx = orbObj.x - enemyObj.x;
    const dy = orbObj.y - enemyObj.y;
    const dz = orbObj.z - enemyObj.z;
    return Math.sqrt(dx*dx + dy*dy + dz*dz) < 1.5;
  }

  function gameLoop(){
    // Move enemies toward player
    enemies.forEach((e,i)=>{
      const pos = e.el.getAttribute('position');
      const dirX = player.getAttribute('position').x - pos.x;
      const dirY = player.getAttribute('position').y - pos.y;
      const dirZ = player.getAttribute('position').z - pos.z;
      e.x += dirX*0.01;
      e.y += dirY*0.01;
      e.z += dirZ*0.01;
      e.el.setAttribute('position',`${e.x} ${e.y} ${e.z}`);
    });

    // Move orbs forward
    orbs.forEach((o, oi)=>{
      o.z -= o.speed;
      o.el.setAttribute('position',`${o.x} ${o.y} ${o.z}`);

      // Check collision with enemies
      enemies.forEach((e, ei)=>{
        if(checkCollision(o, e)){
          // Explosion effect
          const exp = document.createElement('a-sphere');
          exp.setAttribute('position',`${e.x} ${e.y} ${e.z}`);
          exp.setAttribute('radius',1);
          exp.setAttribute('color','#00ffff');
          exp.setAttribute('material','opacity:0.7; transparent:true');
          exp.classList.add('explosion');
          scene.appendChild(exp);
          setTimeout(()=>scene.removeChild(exp),600);

          // Remove orb and enemy
          scene.removeChild(o.el);
          scene.removeChild(e.el);
          orbs.splice(oi,1);
          enemies.splice(ei,1);
        }
      });

      // Remove orb if out of range
      if(o.z < -100) { scene.removeChild(o.el); orbs.splice(oi,1); }
    });

    requestAnimationFrame(gameLoop);
  }

  // Spawn enemy every 3s
  setInterval(spawnEnemy,3000);

  // Shoot on tap
  window.addEventListener('click',shootOrb);

  // Start game loop
  gameLoop();
</script>
</body>
</html>
