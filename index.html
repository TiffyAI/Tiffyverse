<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TiffyAI AR Shooter</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; overflow: hidden; background: black;
      font-family: monospace;
    }

    /* Glass HUD overlay */
    #hud {
      position: absolute;
      top: 10px; left: 50%; transform: translateX(-50%);
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.25);
      border-radius: 12px; padding: 10px 20px;
      color: #00f0ff; font-size: 18px;
      backdrop-filter: blur(8px);
      box-shadow: 0 0 20px rgba(0,255,255,0.4);
      z-index: 9999;
    }

    /* Orbs */
    .orb {
      position: absolute; width: 60px; height: 60px;
      transform: translate(-50%,-50%); pointer-events: none; z-index: 5;
    }

    /* Enemies */
    .enemy {
      position: absolute; width: 120px; height: 120px;
      transform: translate(-50%,-50%); pointer-events: none;
    }

    /* Explosion animation */
    @keyframes explode {
      0%   { transform: scale(1); opacity: 1; }
      50%  { transform: scale(1.6); opacity: 0.8; }
      100% { transform: scale(0); opacity: 0; }
    }
    .explosion { animation: explode 0.6s ease-out forwards; }
  </style>
</head>
<body>

<div id="hud">ðŸ‘¾ Tap anywhere to shoot magic orbs!</div>

<a-scene>
  <!-- Assets -->
  <a-assets>
    <video id="frontVideo" autoplay loop muted playsinline crossorigin="anonymous"
      src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/front.mp4"></video>
    <video id="backVideo" autoplay loop muted playsinline crossorigin="anonymous"
      src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/back.mp4"></video>
    <video id="leftVideo" autoplay loop muted playsinline crossorigin="anonymous"
      src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/left.mp4"></video>
    <video id="rightVideo" autoplay loop muted playsinline crossorigin="anonymous"
      src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/right.mp4"></video>
    <video id="topVideo" autoplay loop muted playsinline crossorigin="anonymous"
      src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/top.mp4"></video>
    <video id="bottomVideo" autoplay loop muted playsinline crossorigin="anonymous"
      src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/bottom.mp4"></video>

    <video id="orbVideo" autoplay loop muted playsinline crossorigin="anonymous"
      src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/orb.mp4"></video>
    <video id="enemyVideo" autoplay loop muted playsinline crossorigin="anonymous"
      src="https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/enemies.mp4"></video>
  </a-assets>

  <!-- Environment planes -->
  <a-plane src="#frontVideo" position="0 1.6 -50" rotation="0 0 0" width="100" height="100"></a-plane>
  <a-plane src="#backVideo" position="0 1.6 50" rotation="0 180 0" width="100" height="100"></a-plane>
  <a-plane src="#leftVideo" position="-50 1.6 0" rotation="0 90 0" width="100" height="100"></a-plane>
  <a-plane src="#rightVideo" position="50 1.6 0" rotation="0 -90 0" width="100" height="100"></a-plane>
  <a-plane src="#topVideo" position="0 101.6 0" rotation="90 0 0" width="150" height="150"></a-plane>
  <a-plane src="#bottomVideo" position="0 -48.4 0" rotation="-90 0 0" width="100" height="100"></a-plane>

  <!-- Player camera -->
  <a-entity id="player" camera look-controls wasd-controls position="0 1.6 0"></a-entity>
</a-scene>

<script>
  // Play all videos on mobile
  window.addEventListener('load', () => {
    ['frontVideo','backVideo','leftVideo','rightVideo','topVideo','bottomVideo','orbVideo','enemyVideo'].forEach(id => {
      const vid = document.getElementById(id);
      vid.muted = true;
      vid.play().catch(err => console.warn(`Autoplay blocked for ${id}:`, err));
    });
  });

  // Game objects
  const enemies = [];
  const orbs = [];

  // Spawn enemies randomly from back/left/right
  function spawnEnemy() {
    const enemy = document.createElement("video");
    enemy.src = "https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/enemies.mp4";
    enemy.autoplay = true;
    enemy.loop = true;
    enemy.muted = true;
    enemy.className = "enemy";

    const side = Math.floor(Math.random()*3); // 0=back,1=left,2=right
    let x=0, y=-100;
    if(side===0){ x = window.innerWidth/2; y=-120; }        // back
    else if(side===1){ x = -50; y = Math.random()*window.innerHeight; } // left
    else{ x = window.innerWidth+50; y = Math.random()*window.innerHeight; } // right

    enemy.style.left = x+"px";
    enemy.style.top = y+"px";

    document.body.appendChild(enemy);
    enemies.push({el: enemy, x, y, side, speed:2+Math.random()*2});
  }

  // Shoot orb from center (front)
  function shootOrb() {
    const orb = document.createElement("video");
    orb.src = "https://raw.githubusercontent.com/TiffyAI/Tiffyverse/refs/heads/main/assets/orb.mp4";
    orb.autoplay = true;
    orb.loop = true;
    orb.muted = true;
    orb.className = "orb";

    let x = window.innerWidth/2;
    let y = window.innerHeight-150;
    orb.style.left = x+"px";
    orb.style.top = y+"px";

    document.body.appendChild(orb);
    orbs.push({el: orb, x, y, speed:8});
  }

  // Collision detection
  function isColliding(a,b){
    const aRect=a.getBoundingClientRect();
    const bRect=b.getBoundingClientRect();
    return !(aRect.top>bRect.bottom || aRect.bottom<bRect.top || aRect.left>bRect.right || aRect.right<bRect.left);
  }

  // Game loop
  function gameLoop(){
    // Move enemies
    for(let i=enemies.length-1;i>=0;i--){
      let e=enemies[i];
      if(e.side===0) e.y+=e.speed;
      else if(e.side===1) e.x+=e.speed;
      else e.x-=e.speed;

      e.el.style.left=e.x+"px";
      e.el.style.top=e.y+"px";

      if(e.y>window.innerHeight+100 || e.x<-200 || e.x>window.innerWidth+200){
        e.el.remove();
        enemies.splice(i,1);
      }
    }

    // Move orbs
    for(let j=orbs.length-1;j>=0;j--){
      let o=orbs[j];
      o.y-=o.speed;
      o.el.style.top=o.y+"px";

      if(o.y<-100){
        o.el.remove();
        orbs.splice(j,1);
      }
    }

    // Check collisions
    for(let i=enemies.length-1;i>=0;i--){
      for(let j=orbs.length-1;j>=0;j--){
        if(isColliding(enemies[i].el,orbs[j].el)){
          enemies[i].el.classList.add("explosion");
          setTimeout(()=>enemies[i].el.remove(),600);
          orbs[j].el.remove();
          enemies.splice(i,1);
          orbs.splice(j,1);
          break;
        }
      }
    }

    requestAnimationFrame(gameLoop);
  }

  // Shoot on screen tap
  window.addEventListener("click", shootOrb);

  // Spawn enemies every 2 seconds
  setInterval(spawnEnemy,2000);

  // Start game loop
  gameLoop();
</script>

</body>
</html>
