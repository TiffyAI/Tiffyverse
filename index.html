<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TiffyAI AR Shooter</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; overflow: hidden; background: black;
      font-family: monospace;
    }

    /* Orbs */
    .orb {
      position: absolute; pointer-events: none; z-index: 5;
      background: none;
      width: auto; height: auto;
    }

    /* Enemies */
    .enemy {
      position: absolute; pointer-events: none;
      background: none;
      width: auto; height: auto;
    }

    /* Explosion animation */
    @keyframes explode {
      0%   { transform: scale(1); opacity: 1; }
      50%  { transform: scale(1.6); opacity: 0.8; }
      100% { transform: scale(0); opacity: 0; }
    }
    .explosion { animation: explode 0.6s ease-out forwards; }

    /* Glow trail for orb */
    .orb::after {
      content: '';
      position: absolute;
      width: 100%; height: 100%;
      top: 0; left: 0;
      border-radius: 50%;
      box-shadow: 0 0 20px 5px #00f0ff;
      animation: trail 0.3s ease-out forwards;
    }
    @keyframes trail {
      from { opacity: 1; transform: scale(1); }
      to { opacity: 0; transform: scale(2); }
    }
  </style>
</head>
<body>

<a-scene embedded>

  <!-- Assets -->
  <a-assets>
    <video id="frontVideo" autoplay loop muted playsinline crossorigin="anonymous" src="front.mp4"></video>
    <video id="backVideo" autoplay loop muted playsinline crossorigin="anonymous" src="back.mp4"></video>
    <video id="leftVideo" autoplay loop muted playsinline crossorigin="anonymous" src="left.mp4"></video>
    <video id="rightVideo" autoplay loop muted playsinline crossorigin="anonymous" src="right.mp4"></video>
    <video id="topVideo" autoplay loop muted playsinline crossorigin="anonymous" src="top.mp4"></video>
    <video id="bottomVideo" autoplay loop muted playsinline crossorigin="anonymous" src="bottom.mp4"></video>

    <video id="orbVideo" autoplay loop muted playsinline crossorigin="anonymous" src="orb.mp4"></video>
    <video id="enemyVideo" autoplay loop muted playsinline crossorigin="anonymous" src="enemies.mp4"></video>
  </a-assets>

  <!-- Environment planes -->
  <a-plane src="#frontVideo" position="0 1.6 -50" rotation="0 0 0" width="100" height="100"></a-plane>
  <a-plane src="#backVideo" position="0 1.6 50" rotation="0 180 0" width="100" height="100"></a-plane>
  <a-plane src="#leftVideo" position="-50 1.6 0" rotation="0 90 0" width="100" height="100"></a-plane>
  <a-plane src="#rightVideo" position="50 1.6 0" rotation="0 -90 0" width="100" height="100"></a-plane>
  <a-plane src="#topVideo" position="0 101.6 0" rotation="90 0 0" width="150" height="150"></a-plane>
  <a-plane src="#bottomVideo" position="0 -48.4 0" rotation="-90 0 0" width="100" height="100"></a-plane>

  <!-- Player camera -->
  <a-entity id="player" camera look-controls wasd-controls position="0 1.6 0"></a-entity>

</a-scene>

<script>
  // Play all videos on mobile
  window.addEventListener('load', () => {
    ['frontVideo','backVideo','leftVideo','rightVideo','topVideo','bottomVideo','orbVideo','enemyVideo'].forEach(id => {
      const vid = document.getElementById(id);
      vid.muted = true;
      vid.play().catch(err => console.warn(`Autoplay blocked for ${id}:`, err));
    });
  });

  const enemies = [];
  const orbs = [];

  function spawnEnemy() {
    const enemy = document.createElement("video");
    enemy.src = "enemies.mp4";
    enemy.autoplay = true; enemy.loop = true; enemy.muted = true;
    enemy.className = "enemy";
    enemy.style.width = "120px"; enemy.style.height = "120px";

    // random back/left/right spawn
    const side = Math.floor(Math.random()*3);
    let x=0, y=0;
    if(side===0){ x=window.innerWidth/2; y=-120; } // back
    else if(side===1){ x=-50; y=Math.random()*window.innerHeight; } // left
    else{ x=window.innerWidth+50; y=Math.random()*window.innerHeight; } // right

    enemy.style.left = x+"px";
    enemy.style.top = y+"px";

    document.body.appendChild(enemy);
    enemies.push({el:enemy,x,y,side,speed:2+Math.random()*2});
  }

  function shootOrb() {
    const orb = document.createElement("video");
    orb.src = "orb.mp4";
    orb.autoplay = true; orb.loop = true; orb.muted = true;
    orb.className = "orb";
    orb.style.width="60px"; orb.style.height="60px";

    let x = window.innerWidth/2;
    let y = window.innerHeight-150;
    orb.style.left = x+"px";
    orb.style.top = y+"px";

    document.body.appendChild(orb);
    orbs.push({el:orb,x,y,speed:8});
  }

  function isColliding(a,b){
    const aRect=a.getBoundingClientRect();
    const bRect=b.getBoundingClientRect();
    return !(aRect.top>bRect.bottom||aRect.bottom<bRect.top||aRect.left>bRect.right||aRect.right<bRect.left);
  }

  function gameLoop(){
    for(let i=enemies.length-1;i>=0;i--){
      let e=enemies[i];
      if(e.side===0) e.y+=e.speed;
      else if(e.side===1) e.x+=e.speed;
      else e.x-=e.speed;
      e.el.style.left=e.x+"px"; e.el.style.top=e.y+"px";

      if(e.y>window.innerHeight+100 || e.x<-200 || e.x>window.innerWidth+200){
        e.el.remove(); enemies.splice(i,1);
      }
    }

    for(let j=orbs.length-1;j>=0;j--){
      let o=orbs[j];
      o.y-=o.speed;
      o.el.style.top=o.y+"px";

      if(o.y<-100){ o.el.remove(); orbs.splice(j,1); }
    }

    for(let i=enemies.length-1;i>=0;i--){
      for(let j=orbs.length-1;j>=0;j--){
        if(isColliding(enemies[i].el,orbs[j].el)){
          enemies[i].el.classList.add("explosion");
          setTimeout(()=>enemies[i].el.remove(),600);
          orbs[j].el.remove();
          enemies.splice(i,1); orbs.splice(j,1); break;
        }
      }
    }

    requestAnimationFrame(gameLoop);
  }

  window.addEventListener("click", shootOrb);
  setInterval(spawnEnemy,2000);
  gameLoop();
</script>
</body>
</html>
